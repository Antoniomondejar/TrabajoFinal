

\begin{lema}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo, y sean $w$, $v \in \W$ tales que $\V(w)$ = $\V(v)$ entonces para toda $\varphi$ proposicional se cumple que, 
    \begin{center}
    $\modults, w \models \varphi$ \quad si y sólo si \quad $ 
    \modults, v \models \varphi$
    \end{center}
\end{lema}

\begin{demostracion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ y $w$, $v \in \W$ tales que $\V(w)$ = $\V(v)$. La demostración es por inducción estructural sobre $\varphi$. Recordar que $\varphi$ es una fórmula \textbf{proposicional}.

    \begin{itemize}
        \item Caso base: $\varphi = p$ donde $p \in \PROP$.

        Notar que  $\modults, w \models \varphi$ si y sólo si $p \in \V(w)$.

        Ahora bien, como $\V(w)$ = $\V(v)$, $p \in \V(w)$ si y sólo si $p \in \V(v)$.

        Finalmente, por la definición de $\models$, $p \in \V(v)$ si y sólo si $\modults, v \models \varphi$.  
    
        \item Caso inductivo: La hipótesis inductiva establece que, para $\psi$ una subfórmula de $\varphi$, se cumple que $\modults, w \models \psi$ si y sólo si $\modults, v \models \psi$.

        \begin{itemize}
            \item Caso $\varphi = \psi_1 \lor \psi_2$. 
    
            Por definición de $\models$, $\modults, w \models \psi_1 \lor \psi_2$ si y sólo si $\modults, w \models \psi_1$ o $\modults, w \models \psi_2$.
            
            Por hipótesis inductiva, $\modults, w \models \psi_1$ o $\modults, w \models \psi_2 $ si y sólo si $\modults, v \models \psi_1$ o $\modults, v \models \psi_2$. 
            
            Pero notar que, nuevamente por definición de $\models$, $\modults, v \models \psi_1$ o $\modults, v \models \psi_2$ si y sólo si $\modults,v \models \psi_1 \lor \psi_2$.  

            \item Caso $\varphi = \neg \psi$.
        
            La demostración es similar a la del caso analizado anteriormente.
        \end{itemize}
    
    \end{itemize}
    
\end{demostracion}


\begin{definicion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo entonces se define, 
    \begin{center}
        $A_\modults := \{(w,v) \in \W \times \W \mid \V(w) = \V(v)\}$
    \end{center}
    Notar que $A_\modults$ es una relación de equivalencia sobre $\W$ (hace falta probarlo? es medio directo). Luego se denotará,
    \begin{center}
        $\rho_\modults := \{ [w] \mid w \in \W $ y $[w]$ su clase de equivalencia respecto a $A_\modults\}$
    \end{center}
\end{definicion}


\begin{lema}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $U \subseteq \W$ entonces,
    \begin{center}

    existe $S \in \mathcal{P}(\rho_\modults)$ finito tal que  $(U = \bigcup\limits_{s_i \in S} s_{i})$ \quad si y sólo si \quad $U$ es proposicionalmente definible. 
    \end{center}
\end{lema}

Intuitivamente, lo que nos dice este lema es que todo conjunto proposicionalmente definible viene de tomar una cierta cantidad de clases de equivalencia de $\rho_\modults$ y unirlas. Y, a su vez, cualquier unión de una cierta cantidad de clases de equivalencia es un conjunto proposicionalmente definible. 


\begin{demostracion}
    Se demostrará por separado los casos $(\rightarrow)$ y $(\leftarrow)$.

    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $U \subseteq \W$. Un primer detalle a tener en cuenta es que, dado que $\modults$ es finito, existen un número finito de variables proposicionales $p_1,...,p_n$ tales que $\{p_1,...,p_n\}$ es la imagen de $\V$.

    \begin{itemize}
        \item $(\rightarrow)$ Notemos primero que si $U = \emptyset$, luego la fórmula $ \varphi := \bot$ define a $U$. Entonces supongamos que $U \neq \emptyset$. (esto se podría analizar por separado o capaz permitir que S sea vacío y que en ese caso $\varphi$ sea una disyunción de 0 cosas por lo que sería el elemento neutro de la disyunción o sea $\bot$).
        
        Sea $S = \{s_1,...,s_m\}$ finito tal que $S \in \mathcal{P}(\rho_\modults)$ y $U = \bigcup\limits_{s_i \in S} s_{i}$, demostremos que $U$ es proposicionalmente definible. 

        Recordar que cada $s_i$ es una clase de equivalencia de la relación $A_\modults$. A su vez, para cada $w$, $v \in s_i$ se cumple que $\V(w) = \V(v)$. Se utilizará $\V(s_i)$ para hacer referencia a $\V(w)$ para cada $w \in s_i$.

        Sea $\varphi_i := \bigwedge\limits_{j = 1}^{n} l_i(p_j)$ donde $l_i(p_j) = $
        $\left\{ \begin{array}{rcl}
                p_j & \mbox{si}
                & p_j \in \V(s_i) \\ \neg p_j & \mbox{si} & p_i \notin \V(s_i) \\
                \end{array}\right.
        $.

        Veamos que por la forma en la que construimos $\varphi_i$, se cumple que $\modults, w \models \varphi_i$ si y sólo si $w \in s_i$. ($*$)
        (esto podría explicarlo/demostrarlo un poco más en profundidad si no es algo claro).
        
        Demostremos entonces que $\varphi := \bigvee\limits_{i = 1}^{m}\varphi_i$ define a $U$. Primero, notar que sea $w \in \W$, $\modults, w \models \varphi$ si y sólo si $\modults, w \models \varphi_i$ para algún $i \in \{1,...m\}$.  

        Queremos ver entonces que, $w \in U$ si y sólo si $\modults, w \models \varphi$. 

        Sea $w \in U$, por hipótesis, existe $s_i$ tal que $w \in s_i$. Ahora bien, por $(*)$, $\modults, w \models \varphi_i$, por lo que $\modults, w \models \varphi$.

        Sea $w \in \W$ tal que $\modults, w \models \varphi$, entonces existe $i \in \{1,...,m\}$ tal que $\modults, w \models \varphi_i$. Luego por $(*)$, $w \in s_i$, lo que nos dice que $w \in U$.

        Luego $\varphi$ define a $U$.
        
        Como $\varphi$ es proposicional, $U$ es proposicionalmente definible. 
    
        \item $(\leftarrow)$ Sea $\varphi$ la fórmula proposicional que define a $U$, se quiere demostrar que existe $S = \{s_1,...,s_m\}$ finito, tal que $S \in \mathcal{P}(\rho_\modults)$ tal que $U = \bigcup\limits_{s_i \in S} s_{i}$. 

        Definamos $U' = \bigcup\limits_{w \in U} [w]$, siendo $[w]$ la clase de equivalencia de $w$ con respecto a $A_\modults$. Notemos que por la definición de $U'$, existe $S \in \mathcal{P}(\rho_\modults)$ finito tal que $U' = \bigcup\limits_{s_i \in S} s_{i}$ dado que $U'$ está definido como una unión finita de elementos de $\mathcal{P}(\rho_\modults)$.

        Demostremos ahora que $U' = U$. Es claro que $U \subseteq U'$, dado que $w \in [w]$ para cada $w \in \W$.

        Queda demostrar que $U' \subseteq U$. 
        
        Sea $w' \in U'$, existe $w \in U$ tal que $w' \in [w]$. Ahora bien, como $w \in U$, $\modults, w \models \varphi$. Luego, notemos que por Lema 1, $\modults, v \models \varphi$ para cada $v \in [w]$, pues $\V(w) = \V(v)$ para cada $v \in [w]$.
        Pero como $w' \in [w]$ esto nos dice que $\modults, w' \models \varphi$. Luego $w' \in U$.

        Finalmente $U' = U$, lo cual demuestra $(\leftarrow)$.
    \end{itemize}

\end{demostracion}

% IDEA PARA PROBAR LO DE QUE CADA CLASE DE EQUIVALENCIA O ESTÁ POR COMPLETO O NO ESTÁ, HABRÍA QUE PROBAR EL SII, ACÁ SOLO PRUEBO EL ->

\mycomment{
\begin{corolario}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $U \subseteq \W$ un conjunto proposicionalmente definible, entonces
    \begin{center}
        $\forall s_i \in \rho_\modults.$ $(s_i \subseteq U \vee s_i \cap U = \emptyset)$
    \end{center}
\end{corolario}

\begin{demostracion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $U \subseteq \W$ proposicionalmente definible.
    
    Supongamos que la propiedad es falsa, luego existe $s' \in \rho_\modults$ tal que $s' \nsubseteq U \wedge s_i \cap U \neq \emptyset$. Notemos que esto dice que existen $w,v \in s'$ tal que $w \in U$ y $v \notin U$.

    A su vez, por Lema 2, como $U$ es proposicionalmente definible existe $S \subseteq \mathcal{P}(\rho_\modults)$ tal que $U = \bigcup\limits_{s_i \in S} s_{i}$. 
    
    Como $w \in U$ y $w \in s'$, entonces ocurre que $s' \in S$, pues recordemos que los elementos de $\rho_\modults$ son clases de equivalencia, es decir, $s'$ es la única clase que contiene a $w$. Ahora bien, pero como $v \in s'$ entonces $v\in U$, lo cuál es absurdo, pues dijimos que $v \notin U$. 

    El absurdo vino de suponer que existía $s' \in \rho_\modults$ tal que  $s' \nsubseteq U \wedge s_i \cap U \neq \emptyset$, luego la propiedad queda demostrada.
\end{demostracion}
}


\begin{corolario}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $U \subseteq \W$ entonces el problema de decidir si $U$ es proposicionalmente definible está en $\Poly$.

    Más aún, en caso de ser definible, encontrar una fórmula $\varphi$ que define a $U$ es realizable en tiempo polinomial en el tamaño de $\modults$.
\end{corolario}
(este corolario es una idea que se me ocurrió que no es central central al problema)

\begin{demostracion}
    Queremos encontrar un algoritmo que dado $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y $U \subseteq \W$ decida en tiempo polinomial en el tamaño de $\modults$ si $U$ es proposicionalmente definible.

    Por Lema 2, sabemos que basta con encontrar $S \in \mathcal{P}(\rho_\modults)$ tal que $U = \bigcup\limits_{s_i \in S} s_{i}$ o determinar que no existe tal $S$.
    
    Como $\rho_\modults$ es la partición de $\W$ con respecto a la relación de equivalencia $A_\modults$, dicho $S \in \mathcal{P}(\rho_\modults)$ existirá si y sólo si ocurre que para cada $s_i \in \rho_\modults$ se cumple que $s_i \subseteq U$ o $s_i$ $\cap$ $U = \emptyset$. (Puedo desarrollar esto acá o incluso probar un lema más que enuncie esto, pero la idea intuitiva es que como queremos chequear que U es unión de clases de equivalencia, entonces si o si tiene que ocurrir que para cada clase de equivalencia están todos sus nodos en U o ninguno está en U)

    Entonces notemos que basta con dar un algoritmo que encuentre las clases de equivalencia de $\rho_\modults$ y para cada una de ellas chequee que, o todos sus nodos pertenecen a $U$ o ninguno de ellos lo hace.

    % acá va algoritmo que chequea si u es definible

    


        

    Luego, en caso de ser $U$ definible, tendremos computado ya el conjunto $S \in \mathcal{P}(\rho_\modults)$ tal que $U = \bigcup\limits_{s_i \in S} s_{i}$, que estaría formado por las clases de equivalencia que encontramos en el paso anterior que están completamente contenidas en $U$.

    Ahora bien, a partir de dicho conjunto $S = \{s_1,...,s_m\}$, podemos computar una fórmula que define a $U$ siguiendo la misma estrategia mencionada en la demostración del Lema 2. 
    
    Es decir, podemos computar $\varphi := \bigvee\limits_{i = 1}^{m}\varphi_i$, con $\varphi_i := \bigwedge\limits_{j = 1}^{n} l_i(p_j)$ donde $l_i(p_j) = $
        $\left\{ \begin{array}{rcl}
                p_j & \mbox{si}
                & p_j \in \V(s_i) \\ \neg p_j & \mbox{si} & p_j \notin \V(s_i) \\
                \end{array}\right.
        $.

    Notar que la cantidad de disyunciones ($m$) de $\varphi$ está acotada por la cantidad de elementos de $\W$ y por otro lado la cantidad de conjunciones de cada término ($n$) es la cantidad de variables proposicionales que aparecen en la imagen de $\V$. Juntando estos dos argumentos, podemos deducir que el tamaño de $\varphi$ es $\bigO(|\W| *|\V|)$, lo cuál es polinomial en el tamaño de $\modults$.

    Falta escribir el algoritmo y probar su complejidad.
\end{demostracion}


\begin{teorema}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo, entonces se cumple que,
    \begin{enumerate}
        \item $A_\modults$ es una autobisimulación de $\modults$.
        \item Sea $Z \subseteq \W \times \W$ una autobisimulación de $\modults$ entonces $Z \subseteq A_\modults$. Es decir, $A_\modults $ es la máxima autobisimulación de $\modults$. 
    \end{enumerate}
\end{teorema}

\begin{demostracion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo, probaremos (1) y (2) por separado:

    \begin{enumerate}
        \item Queremos ver que $A_\modults$ es una autobisimulación de $\modults$, para ello debemos verificar que:
        \begin{itemize}
            \item (Atom) Dado $(w,v) \in A_\modults$, por definición de $A_\modults$, se cumple que $\V(w) = \V(v)$.
            \item (A-Zig) Notemos que $A_\modults$ es una relación de equivalencia, luego para cada $w\in \W$ se cumple que $(w,w) \in A_\modults$.
            \item (A-zag) Podemos utilizar el mismo argumento que en (A-zig) para demostrar este caso.
            \item (\KHilogic-Zig) Queremos ver que para cada $U \subseteq \W$ proposicionalmente definible, si $U \ultsExecAgi T$ para algún $T \subseteq \W$, entonces existe $T' \subseteq \W$ tal que
                \begin{multicols}{2}
                    \begin{itemize}
                        \item $A_\modults(U) \ultsExecAgi T'$, 
                        \item $T' \subseteq A_\modults(T)$.
                    \end{itemize}
                \end{multicols}

            Sean $U,T$ subconjuntos de $\W$ tales que $U \ultsExecAgi T$ y $U$ proposicionalmente definible, queremos encontrar $T' \subseteq \W$ que cumpla lo mencionado.

            Como $U$ es proposicionalmente definible, entonces existe $\varphi$ proposicional tal que $w \in U$ si y sólo si $\modults, w \models \varphi$.
            
            Demostremos por un lado que $U = A_\modults(U)$:
            
            ($\subseteq$) Siguiendo el argumento usado en (A-Zig), es claro que para $w \in U$ se cumple que $w \in A_\modults(U)$, pues $(w,w) \in A_\modults$ para cada $w \in \W$. 
            
            ($\supseteq$) Sea $v \in A_\modults(U)$, queremos ver que $v \in U$.
            Como $v \in A_\modults(U)$, entonces existe $w \in U$ tal que $(w,v) \in A_\modults$. Luego, como $(w,v) \in A_\modults$ entonces $\V(w) = \V(v)$. 
            
            Ahora bien, como $w \in U$ y $\varphi$ define a $U$, esto nos dice que $\modults, w \models \varphi$. Pero por Lema 1, como $\V(w) = \V(u)$ y $\varphi$ es proposicional entonces $\modults, v \models \varphi$, luego $v \in U$.

            Entonces demostramos que $U = A_\modults(U)$.

            Ahora bien, notemos que siendo $X \subseteq \W$ entonces $X \subseteq A_\modults(X)$, pues como analizamos anteriormente $(w,w) \in A_\modults$ para cada $w \in \W$.

             Juntando lo mencionado, podemos afirmar que $T' = T$ cumple que:

             \begin{itemize}
                 \item $A_\modults(U) \ultsExecAgi T'$, pues dijimos $A_\modults(U) = U$, y por hipótesis, $U \ultsExecAgi T = T'$.  
                \item $T' \subseteq A_\modults(T')$ pues esto se cumple para todo $X \subseteq \W$.
            \end{itemize}
            Luego queda demostrado que $A_\modults$ satisface (\KHilogic-Zig).

            \item (\KHilogic-Zag) Análogo a (\KHilogic-Zig), pues notemos que como $A_\modults$ es una relación de equivalencia, es simétrica.
        \end{itemize}

        Luego $A_\modults$ es una autobisimulación de $\modults$.
        
        \item Queremos ver que dada $Z \subseteq \W \times \W$ autobisimulación de $\modults$, entonces $Z \subseteq A_\modults$.
        
        Supongamos que no es cierto, es decir, existe $Z \subseteq \W \times \W$ autobisimulación de $\modults$ tal que hay $w,v \in \W$ que cumplen que $(w,v) \in Z$ y $(w,v) \notin A_\modults$. 

        Como $Z$ es una autobisimulación entonces satisface (atom), es decir, $\V(w) = \V(v)$. Pero notemos que por definición de $A_\modults$, $(w,v) \in A_\modults$, lo cuál es absurdo, pues dijimos que $(w,v) \notin A_\modults$.

        El absurdo vino de suponer que $Z \nsubseteq A_\modults$.

        Luego queda demostrada la propiedad.

        
    \end{enumerate}
\end{demostracion}

% Se me desacomodó el cuadrado del final de la demo, no se cómo arreglarlo


Algo interesante es que hay varias contracciones que no funcionan:

Por ejemplo, dejar las estrategias y las acciones iguales y usar como aristas $\R' = \{(a,[w],[v]) \mid (a,w,v)\in \R\}$. Esta sería la contracción de la lógica modal básica

(Poner gráfico de un contraejemplo).

Otro ejemplo de contracción que no funciona es dejar las estrategias y las acciones iguales y usar como aristas $\R = \{(a,[w],[v]) \mid$ para todo $w' \in [w]$ existe $v' \in [v]$ tal que $(a,w',v') \in \R\}$.

(Poner gráfico de un contraejemplo).

Otro ejemplo sería definir $\R = \{(a,[w],[v]) \mid$ para todo $w' \in [w]$ se cumple que $\R_a(w') \neq \emptyset$ y $(w',v) \in \R_a \}$ y esto tampoco funcionaría.  

(Poner gráfico de un contraejemplo).

Todo este resultado se puede hacer con caso infinito, reescribiendo el lema en vez de si y sólo si a implica, porque lo finito solo se necesita para encontrar la fórmula que en realidad no interesa



\begin{definicion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito. Se define su contracción por bisimulación como el modelo $\model'=\tup{\W',\R',\cset{\S_i'}_{i \in \AGT'},\V',\ACT'}$ donde 
    \begin{center}
    % esto centrarlo mejor de alguna forma
        \begin{itemize}
            \item $\W' := \W/A_\modults$
            \item $\R' := \{\R'_{a_\sigma} \subseteq \W' \times \W' \mid a_\sigma \in \ACT'\}$ donde $([w],[v]) \in \R'_{a_\sigma}$ si y sólo si
            \begin{enumerate}
                \item existen $w' \in [w]$ y $v' \in [v]$ tal que $(w',v')\in \R_\sigma$
                \item $\sigma$ es fuertemente ejecutable para cada $w' \in [w]$.
            \end{enumerate}
            \item $\S_i' := \{ \pi' = \{a_{\sigma_1},...,a_{\sigma_k}\} \mid  
            $ existe $ \pi \in S_i $ tal que $ \pi = \{\sigma_1,...,\sigma_k
            \}\}$
            \item $\V'([w]) := \V(w)$
            \item $\ACT' := \{a_\sigma \mid $ existe $ \pi\in S_i$ tal que $ \sigma \in \pi$ para algún $i \in \AGT \}$ 
        \end{itemize}
    \end{center}
\end{definicion}
    
\begin{teorema}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito y sea $\modults'$ su contracción por bisimulación entonces $\tup{\modults,w}$ y $\tup{\modults',[w]}$ son $\KHilogic$-bisimilares para cada $w \in \W$.
\end{teorema}

\begin{demostracion}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo finito
    y sea $\modults'$ su contracción por bisimulación, basta ver que $Z = \{(w,[w]) \in \W \times\W'\}$ es una \KHilogic-bisimulación para demostrar la propiedad.

    Dado que $\W$ es no vacío entonces es claro que $Z$ es no vacío también.

    Por otro lado, notemos que por la definición de $\V'$, es claro que $Z$ satisface (Atom).

    A su vez, por cómo definimos $Z$, es fácil ver que también (A-zig) y (A-zag) son satisfechos.
    
    Demostremos entonces que se satisfacen (\KHilogic-zig) y (\KHilogic-zag).

    \begin{itemize}
        \item (\KHilogic-zig) Sean $U, T$ subconjuntos de $\W$ tales que $U \ultsExecAgi T$ y $U$ proposicionalmente definible, queremos encontrar $T' \subseteq \W'$ que

        \begin{multicols}{2}
            \begin{itemize}
                \item $Z(U) \ultsExecAgi T'$, 
                \item $T' \subseteq Z(T)$.
            \end{itemize}
        \end{multicols}

        Veamos que $T' = \{ [w] \mid w \in T\}$ cumple con lo mencionado. Por como definimos $Z$, es claro que $T'  = Z(T)$, por lo que $T' \subseteq Z(T)$. Entonces demostremos $Z(U) \ultsExecAgi T'$.


        Como $U \ultsExecAgi T$, existe $\pi = \{\sigma_1,...,\sigma_k\} \in S_i$ tal que cada plan de $\pi$ es fuertemente ejecutable en cada nodo de $U$ y $\R_\pi(U) \subseteq T$. 

        Ahora bien, sabemos por la definición de $\modults'$ que existe $\pi' =\{a_{\sigma_1},...,a_{\sigma_k}\} \in S_i'$. Luego, basta ver que cada $a_{\sigma_i}$ es fuertemente ejecutable en $Z(U)$ y que además $\R'_{\pi'}(Z(U)) \subseteq T'$, pues, juntando las dos afirmaciones concluiríamos que $Z(U) \ultsExecAgi T'$.


        Notemos que los planes de $\pi'$ son simplemente de un paso, es decir, deberíamos chequear que para cada elemento de $Z(U)$ existe una arista con cada una de las acciones de $\pi'$ y que cada arista de $Z(U)$ con alguna de las etiquetas de $\pi'$ se dirige hacia un nodo de $T'$. 

        Por Lema 2, existe $S \in \mathcal{P}(\rho_\modults)$ tal que $U  = \bigcup\limits_{s_i \in S} s_{i}$. Luego, por como está definido $Z$, notemos que $Z(U) = S$.

        Sean entonces $a_{\sigma_i} \in \pi'$ y $s_j \in S$ queremos ver que $a_{\sigma_i}$ es fuertemente ejecutable en $s_j$. Como cada nodo de $s_j$ está en $U$ y $\sigma_i$ es fuertemente ejecutable en todo nodo de $U$ entonces para cada nodo $w$ de $s_j$ existe $v$ tal que $(w,v) \in \R_{\sigma_i}$. A su vez, juntando lo mencionado, se puede ver que por la definición de $\R'$ entonces existe $v \in \W$ tal que $(s_j,[v]) \in \R'_{a_{\sigma_i}}$, luego $a_{\sigma_i}$ es fuertemente ejecutable en $s_j$. Como $a_{\sigma_i}$ y $s_j$ eran elementos fijos pero arbitrarios de $\pi'$ y $S$ respectivamente, vale que $\pi'$ es fuertemente ejecutable en todo $S$.

        Ya demostramos entonces que $\pi'$ es fuertemente ejecutable en $S$, queda demostrar que $\R'_{\pi'}(S) \subseteq T'$.

        Sean $s_j \in S$ y $a_{\sigma_i} \in \pi'$ tales que $(s_j,[v]) \in \R'_{a_{\sigma_i}}$ entonces existen $w \in s_j$ y  $v' \in [v]$ tales que $(w,v') \in \R'_{\sigma_i}$. Recordemos que $\R_\pi(U) \subseteq T$.  Luego, como $w \in U$ y $\sigma_i \in \pi$ entonces $v' \in T$, lo que nos dice que $[v] \in T'$. Entonces queda demostrado que $\R'_{\pi'}(S) \subseteq T'$, dado que $s_j$ y $a_{\sigma_i}$ son elementos fijos pero arbitrarios de $S$ y $\pi'$ respectivamente.

        Probamos entonces que $\pi'$ es fuertemente ejecutable en $S$ y que $\R'_{\pi'}(S) \subseteq T'$, luego esto nos dice que $S \ultsExecAgi T'$. Y como $S = Z(U)$, $Z(U) \ultsExecAgi T'$.

        Queda demostrado entonces \KHilogic-zig. (MEJORAR ESTA DEMO).

        \item (\KHilogic-zag) Sean $U, T \in \W'$ tales que $U \ultsExecAgi T$ con $U$ proposicionalmente definible, queremos encontrar $T' \subseteq \W$ tal que
        \begin{multicols}{2}
            \begin{itemize}
                \item $Z^{-1}(U) \ultsExecAgi T'$, 
                \item $T' \subseteq Z^{-1}(T)$.
            \end{itemize}
        \end{multicols}

        Notar que $U = \{[w_1],...,[w_n]\mid w_i \in \W \}$ y $T = \{[v_1],...,[v_m]\mid v_i \in \W \}$.
        
        Veamos que $T' = \bigcup\limits_{[v_i] \in T} [v_i]$ cumple con lo mencionado. Notar que por la definición de $Z$, es claro que $T' = Z^{-1}(T)$, lo que nos dice que $T' \subseteq Z^{-1}(T)$. Demostremos entonces que $Z^{-1}(U) \ultsExecAgi T'$. 
    
        Como $U \ultsExecAgi T$, entonces existe $\pi' = \{a_{\sigma_1},...,a_{\sigma_k}\}\in S_i'$ tal que $\pi'$ es fuertemente ejecutable en cada elemento de $U$ y $\R'_{\pi'}(U) \subseteq T$.

        Luego por como está definido $\modults$ entonces existe $\pi = \{\sigma_1,...,\sigma_k\} \in S_i$. Veamos entonces que $\pi$ es fuertemente ejecutable en cada nodo de $Z^{-1}(U)$ y a su vez que $\R_\pi(Z^{-1}(U)) \subseteq T'$.

        Sean $w \in Z^{-1}(U)$ y $\sigma_i \in \pi$, veamos que $\sigma_i$ es fuertemente ejecutable en $w$. Notemos que como $w \in Z^{-1}(U)$ entonces $[w] \in U$ y, a su vez, como $a_{\sigma_i}$ es fuertemente ejecutable en $U$, $a_{\sigma_i}$ también es fuertemente ejecutable en $[w]$. Luego, existe $[v]$ tal que $([w],[v]) \in \R'_{a_{\sigma_i}}$. Ahora bien, notemos que por la definición de $\R'$, como existe esa arista entonces se cumple que $\sigma_i$ es fuertemente ejecutable en todo nodo de $[w]$. En particular, $\sigma_i$ es fuertemente ejecutable en $w$. Finalmente, demostramos que $\pi$ es fuertemente ejecutable en $Z^{-1}(U)$.

        Demostremos ahora que $\R_{\pi}(Z^{-1}(U)) \subseteq T'$. 

        Sean $w, v \in \W$ tales que $w \in Z^{-1}(U)$ y $(w,v) \in \R_{\sigma_i}$, queremos ver que $v \in T'$. Notemos que como $w \in Z^{-1}(U)$, entonces $[w] \in U$. Ahora bien como $a_{\sigma_i}$ es fuertemente ejecutable en $U$, $a_{\sigma_i}$ también es fuertemente ejecutable en $[w]$.
        
        Como $a_{\sigma_i}$ es fuertemente ejecutable en $[w]$ entonces existe $[v']$ tal que $([w],[v']) \in \R_{a_{\sigma_i}}$. Ahora bien, como existe dicha arista, por la definición de $\R'$, ocurre que $\sigma_i$ es fuertemente ejecutable en todo nodo de $[w]$. Pero como $\sigma_i$ es fuertemente ejecutable en todo nodo de $[w]$ y $(w,v) \in \R_{\sigma_i}$ entonces $([w],[v]) \in \R'_{a_{\sigma_i}}$. Pero como $\R'_{\pi'}(U) \subseteq T$, entonces $[v] \in T$, lo que nos dice que $v \in T'$.
        
        Luego demostramos que $\R_{\sigma_i}(Z^{-1}(U)) \subseteq T'$. Como $\sigma_i$ era un elemento fijo pero arbitrario de $\pi$ entonces vale para todo $\pi$. Luego $\R_\pi(Z^{-1}(U)) \subseteq T'$, lo cual demuestra \KHilogic-zag.
    \end{itemize}

    Demostramos entonces que $Z$ es una \KHilogic-bisimulación. Luego $\tup{\modults,w}$ y $\tup{\modults',[w]}$ son $\KHilogic$-bisimilares para cada $w \in \W$.
    
\end{demostracion}



\begin{teorema}
    La contracción por bisimulación de un modelo finito $\modults$ tiene cardinalidad mínima entre los modelos $\KHilogic$-bisimilares a $\modults$.
\end{teorema}
(este no estoy seguro de cómo probarlo pero estaría bueno que sea cierto para demostrar que efectivamente estamos minimizando el modelo).

update de esto: cardinalidad es bastante directo, pero cantidad de aristas debe ser bastante más complicado, por lo que me contaste de cocientar las clases de estrategias.

\begin{teorema}
    Sea $\modults$ un modelo finito, encontrar su contracción por bisimulación $\modults'$ es realizable en tiempo polinomial en el tamaño de $\modults$.
\end{teorema}

(la mejor complejidad con la que se podría hacer no estoy seguro, porque tampoco definimos bien cómo va a ser la contracción, pero lo de encontrar los nodos strongly executable de cada camino se me ocurre que puede salir en $\mathcal{O}(\sum_{i} |S_i|*n*(n+m))$)


Esta definición va a ir en los premilinares pero la escribo acá para tenerla a mano al ver esta demo
\begin{definicion}
    Supongamos $\ACT$ un conjunto de acciones no vacío enumerable.
    Sea $\modults = \tup{\W,\{\R_a\}_{a\in\ACT},\V}$ un modelo de Kripke. Sea $Z_\modults$ su autobisimulación máxima en Lógica Modal Básica (LMB) entonces definimos su contracción por LMB-bisimulación como $\modults_{LMB} = \tup{\W',\{\R'_a\}_{a\in\ACT},\V}$ donde
    \begin{center}
        \begin{itemize}
            \item $\W' := \W /Z_\modults$
            \item $\R_a' := \{([w],[v]) \mid$ existen $w' \in [w]$ y $v' \in [v]$ tal que $(w',v') \in \R_a \}$
            \item $\V'([w]) := \V(w)$
        \end{itemize}
    \end{center}
    
    
\end{definicion}

Notar que en el contexto de esta definición, $[w]$ se refiere a la clase de equivalencia de $w$ en la relación de equivalencia dada por $Z_\modults$. 


\begin{lema}
    Sea $\model = \tup{\W,\{\R_a\}_{a\in\ACT},\V}$ un modelo de Kripke, y sea $\modults_{LMB} = \tup{\W',\{\R_a'\}_{a\in\ACT},\V'}$ su contracción por LMB-bisimulación,
    \begin{center}
        Si $([w],[v]) \in \R'_a$ entonces para cada $w' \in [w]$ existe $v' \in [v]$ tal que $(w',v') \in \R_a$
    \end{center}
\end{lema}



\begin{demostracion}
    Sea $\model = \tup{\W,\{\R_a\}_{a\in\ACT},\V}$ un modelo de Kripke, y sea $\modults_{LMB} = \tup{\W',\{\R_a'\}_{a\in\ACT},\V'}$ su contracción por LMB-bisimulación. Sea $([w],[v]) \in \R'_a$, veamos que para cada $w' \in [w]$ existe $v' \in [v]$ tal que $(w',v') \in \R_a$.

    Como $([w],[v]) \in \R'_a$ existen $w_0 \in [w]$ y $v_0 \in [v]$ tales que $(w_0,v_0)\in \R_a$. Ahora bien, sea $w' \in [w]$, por estar ambos $w_0$ y $w'$ en $[w]$, existe una LMB-bisimulación $Z$ tal que $(w_0,w') \in Z$. Pero notemos que, por (zig) de $Z$, como $(w_0,v_0) \in \R_a$  entonces existe $v'$ tal que $(w',v') \in \R_a$ y, a su vez, $(v_0,v') \in Z$, es decir, $v' \in [v]$. Como demostramos esto para un $w'$ arbitrario en $[w]$, vale para todo elemento de $[w]$.
\end{demostracion}


\begin{teorema}
    Sea $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ un modelo y sea $\modults_{LMB} = \tup{\W',\{\R_a'\}_{a\in\ACT},\V'}$ la contracción por LMB-bisimulación del modelo $\tup{\W,\{\R_a\}_{a\in\ACT},\V}$, entonces $\tup{\modults,w}$ y $\tup{\modults',[w]}$ son $\KHilogic$-bisimilares para cada $w \in \W$ siendo $\modults' = \tup{\W',\R',\cset{\S_i}_{i \in \AGT},\V',\ACT}$.
\end{teorema}

Notar que en este teorema, al fijar $\model=\tup{\W,\R,\cset{\S_i}_{i \in \AGT},\V,\ACT}$ inmediatamente fijamos a $\ACT$ como el conjunto no vacío enumerable de acciones para la Lógica Modal Básica.

\begin{demostracion}
    Queremos ver que $Z = \{(w,[w]) \mid w \in \W\}$ es una \KHilogic-bisimulación.
    
    Por definición de la contracción por bisimulación en (LMB) se puede ver que se satisface (atom). Luego, por definición de Z, es fácil ver que (A-zig) y (A-zag) son satisfechas. Demostremos entonces (\KHilogic-zig) y (\KHilogic-zag).

    \begin{itemize}
        \item (\KHilogic-zig). Sean $U, T$ ambos subconjuntos de $\W$ tales que $U$ es proposicionalmente definible y $U \ultsExecAgi T$. Queremos ver que existe $T' \subseteq \W'$ tal que

        \begin{multicols}{2}
            \begin{itemize}
                \item $Z(U) \ultsExecAgi T'$, 
                \item $T' \subseteq Z(T)$.
            \end{itemize}
        \end{multicols}
        Veamos que $T' = \{[w] \mid w \in T\}$ cumple con lo mencionado. Notemos que $T' = Z(T)$, por lo que solo debemos demostrar $Z(U) \ultsExecAgi T'$.

        Como $U \ultsExecAgi T$, existe $\pi \in S_i$ tal que $\pi$ es fuertemente ejecutable en $U$ y a su vez $\R_\pi(U) \subseteq T$.

        Demostremos que $\pi$ es fuertemente ejecutable en $Z(U)$ y que $\R'_\pi(Z(U)) \subseteq T'$.

        Supongamos que $\pi$ no es fuertemente ejecutable en $Z(U)$. Luego existe $\sigma \in \pi$ y $[w_1],...,[w_k]$ con $0 \le k \le |\sigma|$ tal que $[w_1] \in Z(U)$, $([w_i], [w_{i+1}]) \in \R'_{\sigma[i]}$ y $\R'_{\sigma[k]}([w_k]) = \emptyset$.

        Ahora bien, como $[w_1] \in Z(U)$, existe $w_1' \in U$ tal que $w_1' \in [w_1]$. Luego notemos que aplicando sucesivamente el Lema 3 en todo el camino, existen $w_1',...w_k'$ tales que $w_i' \in [w_i]$ y $(w_i',w_{i+1}') \in \R_{\sigma[i]}$.

        Pero veamos que esto nos dice que $\R_{\sigma[k]}(w_k') = \emptyset$. Pues, si existiera $v$ tal que $(w_k',v) \in \R_{\sigma[k]}$ entonces ocurriría que $([w_k],[v]) \in \R'_{\sigma[k]}$. Luego $\sigma \in \pi$ no es fuertemente ejecutable en $w_1' \in U$, lo cuál es absurdo, pues dijimos que $\pi$ es fuertemente ejecutable en todo $U$.

        Esto nos dice que $\pi$ es fuertemente ejecutable en $Z(U)$.

        Veamos ahora que $\R'_\pi(Z(U)) \subseteq T'$.

        Sea $[v] \in \R'_\pi(Z(U))$, entonces existen $\sigma \in \pi$ y $[w_1], ..., [w_{|\sigma|+1}]$ tales que $[w_1] \in Z(U)$, $([w_i],[w_{i+1}]) \in \R'_{\sigma[i]}$ y $[w_{|\sigma|+1}] = [v]$.

        Ahora bien, como $[w_1] \in Z(U)$, entonces existe $w_1' \in U$ tal que $w_1'\in [w_1]$. Luego notemos que aplicando sucesivamente el Lema 3 sobre el camino, existen $w_1',...,w_{|\sigma|+1}'$ tales que $w_i' \in [w_i]$ y $(w_i',w_{i+1}')\in \R_{\sigma[i]}$. Como $\R_\pi(U) \subseteq T$ esto nos dice que $w'_{|\sigma|+1} \in T$. Finalmente, por definición de $T'$, $[w_{|\sigma|+1}] \in T'$. Luego como $[v] = [w_{|\sigma|+1}]$, $[v] \in T'$.

        Entonces demostramos que $\pi$ es fuertemente ejecutable en $Z(U)$ y que $\R'_\pi(Z(U)) \subseteq T'$. Juntando ambos resultados, concluimos que $Z(U) \ultsExecAgi T'$, lo cuál demuestra (\KHilogic-zig).

       \item (\KHilogic-zag) Sean $U,T$ ambos subconjuntos de $\W'$ tales que $U$ es proposicionalmente definible y $U \ultsExecAgi T$. Queremos ver que existe $T' \subseteq \W$ tal que

       \begin{multicols}{2}
            \begin{itemize}
                \item $Z^{-1}(U) \ultsExecAgi T'$, 
                \item $T' \subseteq Z^{-1}(T)$.
            \end{itemize}
        \end{multicols}

        Veamos que $T' = \{w \mid [w] \in T\}$ cumple con lo mencionado. Notemos que $T' = Z^{-1}(T)$ por lo que solo debemos demostrar $Z^{-1}(U) \ultsExecAgi T'$.

        Como $U \ultsExecAgi T$, existe $\pi \in S_i$ tal que $\pi$ es fuertemente ejecutable en todo $U$ y a su vez $\R'_\pi(U) \subseteq T$.

        Veamos que $\pi$ es fuertemente ejecutable en $Z^{-1}(U)$ y que $\R_\pi(Z^{-1}(U)) \subseteq T'$.

        Supongamos que $\pi$ no es fuertemente ejecutable en $Z^{-1}(U)$. Luego existe $\sigma \in \pi$ y $w_1,...,w_k$ con $0 \le k \le |\sigma|$ tal que $w_1 \in Z^{-1}(U)$, $(w_i,w_{i+1}) \in \R_{\sigma[i]}$ y $\R_{\sigma[k]}(w_k) = \emptyset$. 

        Ahora bien, notemos entonces que por la definición de $\R'$, $[w_1],...,[w_k]$ cumple que $([w_i],[w_{i+1}]) \in \R'_{\sigma[i]}$ y, a su vez, que $[w_1] \in U$, pues $w_1 \in Z^{-1}(U)$. Pero notemos que como $\R_{\sigma[k]}(w_k) = \emptyset$, por la contrarrecíproca del Lema 3, podemos ver que $\R'_{\sigma[k]}([w_k]) = \emptyset$, lo que nos dice que $\sigma \in \pi$ no es fuertemente ejecutable en $[w_1] \in U$. Absurdo, pues dijimos que $\pi$ es fuertemente ejecutable en todo $U$.

        Esto nos dice que $\pi$ es fuertemente ejecutable en todo $Z^{-1}(U)$.

        Veamos ahora que $\R_\pi(Z^{-1}(U)) \subseteq T'$.

        Sea $v \in \R_\pi(Z^{-1}(U))$, entonces existen $\sigma \in \pi$ y $w_1,...,w_{|\sigma|+1}$ tales que $w_1 \in Z^{-1}(U)$, $(w_i,w_{i+1}) \in \R_{\sigma[i]}$ y $w_{|\sigma|+1} = v$. 

        Ahora bien, por la definición de $\R'$, esto nos dice que $[w_1],...,[w_{|\sigma|+1}]$ cumple que $([w_i],[w_{i+1}]) \in \R'_{\sigma[i]}$ y, a su vez, como $w_1 \in Z^{-1}(U)$ entonces $[w_1] \in U$. Luego notemos que como $\R'_\pi(U) \subseteq T$, esto nos dice que $[w_{|\sigma|+1}] \in T$, lo cuál implica que $w_{|\sigma|+1} \in T'$. Como $v = w_{|\sigma|+1}$ entonces $v \in T'$. 

        Entonces demostramos que $\pi$ es fuertemente ejecutable en todo $Z^{-1}(U)$ y que $\R'_\pi(Z^{-1}(U)) \subseteq T'$. Juntando ambos resultados, concluimos que $Z^{-1}(U) \ultsExecAgi T'$, lo cuál demuestra (\KHilogic-zag).
    \end{itemize}

    Demostramos entonces que $Z$ es una \KHilogic-bisimulación. Luego $\tup{\modults,w}$ y $\tup{\modults',[w]}$ son $\KHilogic$-bisimilares para cada $w \in \W$.
    
\end{demostracion}
